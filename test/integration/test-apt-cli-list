#!/bin/sh
set -e

TESTDIR=$(readlink -f $(dirname $0))
. $TESTDIR/framework

setupenvironment
configarchitecture "i386"

insertpackage 'unstable' 'foo' 'all' '1.0'
insertinstalledpackage 'bar' 'i386' '1.0'

insertinstalledpackage 'foobar' 'i386' '1.0'
insertpackage 'unstable' 'foobar' 'i386' '2.0'

setupaptarchive

APTARCHIVE=$(readlink -f ./aptarchive)

testequal "Listing...
bar/now 1.0 [installed,local] i386
foo/unstable 1.0 all
foobar/unstable 2.0 [upgradable from: 1.0] i386" apt list

testequal "Listing...
foo/unstable 1.0 all
foobar/unstable 2.0 [upgradable from: 1.0] i386" apt list "foo*"

testequal "Listing...
foobar/unstable 2.0 [upgradable from: 1.0] i386" apt list --upgradable

# FIXME: hm, hm - does it make sense to have this different? shouldn't
#        we use "installed,upgradable" consitently?
testequal "Listing...
bar/now 1.0 [installed,local] i386
foobar/now 1.0 [installed,upgradable to: 2.0] i386" apt list --installed

testequal "Listing...
foobar/unstable 2.0 [upgradable from: 1.0] i386
foobar/now 1.0 [installed,upgradable to: 2.0] i386
" apt list foobar --all-versions

testequal "Listing...
bar/now 1.0 [installed,local] i386
  an autogenerated dummy bar=1.0/installed
" apt list bar --verbose

